define(["require","exports"],function(){var t=function(){function t(t,s,i){"undefined"==typeof s&&(s={musicOn:!0});var e=this,n=0,u=document.createElement("audio");if(this.support="function"==typeof u.canPlayType&&(""!==u.canPlayType("audio/mpeg")||""!==u.canPlayType("audio/ogg")),this.onload=i,this.soundNames=["jump","coin","enemy_die","grow","hurt","mushroom","shell","shoot","lifeupgrade"],this.musicNames=["game","invincible","die","success","gameover","peach","ending","menu","editor"],this.musicLoops=[!0,!1,!1,!1,!1,!0,!1,!0,!0],this.sounds=[],this.tracks=[],this.settings=s,this.currentMusic=null,this.sides=0,this.support){var r=0,o=u.canPlayType("audio/ogg").match(/maybe|probably/i)?".ogg":".mp3",c=function(){n++<25&&r>0?setTimeout(c,100):e.loaded()};this.soundNames.forEach(function(s){++r;var i=document.createElement("audio");i.addEventListener("error",function(){return--r},!1),i.addEventListener("loadeddata",function(){return--r},!1),i.src=t+s+o,i.preload="auto",e.sounds.push([i])}),this.musicNames.forEach(function(s,i){++r;var n=document.createElement("audio");n.addEventListener("error",function(){return--r},!1),n.addEventListener("loadeddata",function(){return--r},!1),n.src=t+s+o,e.musicLoops[i]?"boolean"!=typeof n.loop?n.addEventListener("ended",function(){this.currentTime=0,this.play()},!1):n.loop=!0:n.addEventListener("ended",function(){return e.sideMusicEnded()},!1),n.preload="auto",e.tracks.push(n)}),void 0!==i&&c()}else this.loaded()}return t.prototype.loaded=function(){this.onload&&setTimeout(this.onload,10)},t.prototype.play=function(t){if(this.settings&&this.settings.musicOn&&this.support)for(var s=this.soundNames.length;s--;)if(this.soundNames[s]===t){for(var i=this.sounds[s],e=i.length;e--;){if(0===i[e].duration)return;if(i[e].ended)i[e].currentTime=0;else if(i[e].currentTime>0)continue;return void i[e].play()}var n=document.createElement("audio");return n.src=i[0].src,i.push(n),void n.play()}},t.prototype.pauseMusic=function(){this.support&&this.currentMusic&&this.currentMusic.pause()},t.prototype.playMusic=function(){this.support&&this.currentMusic&&this.settings.musicOn&&this.currentMusic.play()},t.prototype.sideMusicEnded=function(){this.sides--,0===this.sides&&(this.currentMusic=this.previous,this.playMusic())},t.prototype.sideMusic=function(t){if(this.support){0===this.sides&&(this.previous=this.currentMusic,this.pauseMusic());for(var s=this.musicNames.length;s--;)if(this.musicNames[s]===t){this.currentMusic!==this.tracks[s]&&(this.sides++,this.currentMusic=this.tracks[s]);try{this.currentMusic.currentTime=0,this.playMusic()}catch(i){this.sideMusicEnded()}}}},t.prototype.music=function(t,s){if(this.support)for(var i=this.musicNames.length;i--;)if(this.musicNames[i]===t){var e=this.tracks[i];if(e===this.currentMusic)return;if(this.pauseMusic(),this.currentMusic=e,!this.support)return;try{s||(this.currentMusic.currentTime=0),this.playMusic()}catch(n){}}},t}();return t});